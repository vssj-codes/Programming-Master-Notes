## Python Django Tutorial: Deploying Your Application (Option #1) - Deploy to a Linux Server

### Key Insights

- **Introduction to Deployment**
  - Deploying a Django application to a Linux server for internet access.
  - Multiple deployment options: Linux server, Heroku, PythonAnywhere.

- **Using Linode for Deployment**
  - Linode provides $20 free credit for new accounts.
  - Deployment involves setting up a virtual machine (VM) on Linode.

- **Initial Setup on Linode**
  - Create a new Linode instance using the Ubuntu image.
  - Set up a hostname and create a limited user with sudo privileges.
  - Configure SSH for secure login:
    - Generate SSH keys on local machine.
    - Copy the public key to the server and configure permissions.

- **Server Preparation**
  - Update and upgrade server packages.
  - Install necessary software: Python, pip, virtual environment.
  - Create a virtual environment for the Django project on the server.

- **Transferring Django Project to Server**
  - Use SCP (Secure Copy Protocol) to transfer the project files.
  - Ensure all dependencies are installed via `requirements.txt`.

- **Configuring Django on the Server**
  - Update `settings.py`:
    - Add server IP to `ALLOWED_HOSTS`.
    - Set up static and media file directories.
  - Run `collectstatic` to gather static files.

- **Setting Up Apache with mod_wsgi**
  - Install Apache and mod_wsgi:
    ```bash
    sudo apt-get install apache2
    sudo apt-get install libapache2-mod-wsgi-py3
    ```
  - Configure Apache to serve the Django application:
    - Create a new site configuration file in `/etc/apache2/sites-available/`.
    - Set up WSGI script alias and process group.

- **Handling Sensitive Information**
  - Move sensitive data (e.g., SECRET_KEY, email credentials) to a config file.
  - Load the config file in `settings.py`.

- **Finalizing Deployment**
  - Adjust file permissions for database and media directory.
  - Enable UFW (Uncomplicated Firewall) and allow necessary ports:
    ```bash
    sudo ufw allow 'Apache'
    sudo ufw enable
    ```
  - Restart Apache server:
    ```bash
    sudo service apache2 restart
    ```

### Code Snippets

1. **User Model Correction**
    ```python
    class User(models.Model):
        # existing fields
        def save(self, *args, **kwargs):
            super().save(*args, **kwargs)
    ```

2. **SSH Key Generation (Local Machine)**
    ```bash
    ssh-keygen -b 4096
    ssh-copy-id user@server_ip
    ```

3. **Setting Up Firewall**
    ```bash
    sudo ufw default allow outgoing
    sudo ufw default deny incoming
    sudo ufw allow ssh
    sudo ufw allow 'Apache'
    sudo ufw enable
    ```

4. **Apache Configuration Example**
    ```apache
    <VirtualHost *:80>
        ServerName your_domain_or_IP

        Alias /static /home/username/django_project/static
        <Directory /home/username/django_project/static>
            Require all granted
        </Directory>

        Alias /media /home/username/django_project/media
        <Directory /home/username/django_project/media>
            Require all granted
        </Directory>

        <Directory /home/username/django_project/django_project>
            <Files wsgi.py>
                Require all granted
            </Files>
        </Directory>

        WSGIDaemonProcess django_app python-path=/home/username/django_project python-home=/home/username/django_project/venv
        WSGIProcessGroup django_app
        WSGIScriptAlias / /home/username/django_project/django_project/wsgi.py
    </VirtualHost>
    ```

5. **Loading Config in `settings.py`**
    ```python
    import json

    with open('/etc/config.json') as config_file:
        config = json.load(config_file)

    SECRET_KEY = config['SECRET_KEY']
    EMAIL_HOST_USER = config['EMAIL_USER']
    EMAIL_HOST_PASSWORD = config['EMAIL_PASS']
    ```

This summary covers the essential steps and configurations for deploying a Django application to a Linux server using Linode, ensuring that it is accessible, secure, and functional.
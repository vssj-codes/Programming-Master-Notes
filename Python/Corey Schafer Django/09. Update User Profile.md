# Python Django Tutorial: Full-Featured Web App Part 9 - Update User Profile - YouTube

## Key Insights and Code Snippets

### Overview
In this tutorial, we enhance the user profile page to allow users to update their information, including their profile picture. We will use forms, handle file uploads, and automatically resize uploaded images.

### Creating Forms
- **User Update Form:**
  - Create a `UserUpdateForm` class inheriting from `forms.ModelForm`.
  - Include `username` and `email` fields, excluding password fields.

    ```python
    from django import forms
    from django.contrib.auth.models import User

    class UserUpdateForm(forms.ModelForm):
        class Meta:
            model = User
            fields = ['username', 'email']
    ```

- **Profile Update Form:**
  - Create a `ProfileUpdateForm` class inheriting from `forms.ModelForm`.
  - Include the `image` field from the `Profile` model.

    ```python
    from .models import Profile

    class ProfileUpdateForm(forms.ModelForm):
        class Meta:
            model = Profile
            fields = ['image']
    ```

### Updating Views
- **Profile View:**
  - Import the forms and instantiate them in the profile view.
  - Handle form submission and validation.

    ```python
    from django.shortcuts import render, redirect
    from django.contrib import messages
    from .forms import UserUpdateForm, ProfileUpdateForm

    def profile(request):
        if request.method == 'POST':
            u_form = UserUpdateForm(request.POST, instance=request.user)
            p_form = ProfileUpdateForm(request.POST, request.FILES, instance=request.user.profile)
            
            if u_form.is_valid() and p_form.is_valid():
                u_form.save()
                p_form.save()
                messages.success(request, f'Your account has been updated!')
                return redirect('profile')
        else:
            u_form = UserUpdateForm(instance=request.user)
            p_form = ProfileUpdateForm(instance=request.user.profile)

        context = {
            'u_form': u_form,
            'p_form': p_form
        }
        
        return render(request, 'users/profile.html', context)
    ```

### Template Adjustments
- **Profile Template:**
  - Use a single HTML form to display both the user and profile forms.
  - Include necessary encoding type for file uploads.

    ```html
    {% load crispy_forms_tags %}
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Profile Info</legend>
            {{ u_form|crispy }}
            {{ p_form|crispy }}
        </fieldset>
        <div class="form-group">
            <button class="btn btn-outline-info" type="submit">Update</button>
        </div>
    </form>
    ```

### Resizing Uploaded Images
- **Overriding the Save Method:**
  - Use Pillow to resize images before saving.

    ```python
    from PIL import Image

    class Profile(models.Model):
        user = models.OneToOneField(User, on_delete=models.CASCADE)
        image = models.ImageField(default='default.jpg', upload_to='profile_pics')

        def save(self, *args, **kwargs):
            super().save(*args, **kwargs)
            
            img = Image.open(self.image.path)
            
            if img.height > 300 or img.width > 300:
                output_size = (300, 300)
                img.thumbnail(output_size)
                img.save(self.image.path)
    ```

### Displaying User Images
- **Homepage Template:**
  - Display the authorâ€™s profile image next to each post.

    ```html
    <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}" alt="Profile picture">
    ```

### Summary
- Created user and profile update forms.
- Implemented view logic to handle form submission and validation.
- Adjusted profile template to display and submit the update forms.
- Resized uploaded images using Pillow.
- Displayed user profile images on the homepage.

This summary and code snippets provide a clear revision guide for enhancing user profile functionalities in a Django web application.
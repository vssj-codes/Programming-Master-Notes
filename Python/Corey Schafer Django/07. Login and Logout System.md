# Python Django Tutorial: Full-Featured Web App Part 7 - Login and Logout System

## Key Insights

- **Overview**: This tutorial demonstrates how to create an authentication system in Django, allowing users to log in, log out, and access restricted pages.
- **Default Login Views**: Django provides built-in views for login and logout, which can be used to handle authentication.
- **Setting Up Routes**: Import and set up routes for login and logout in the project's `urls.py`.
- **Custom Templates**: Create custom templates for login and logout to match the website's style.
- **Redirects and Settings**: Adjust settings to control post-login redirection.

## Steps and Code Snippets

### 1. Import Django's Built-in Authentication Views

In the project's `urls.py`:
```python
from django.contrib.auth import views as auth_views
```

### 2. Define Routes for Login and Logout

Add paths for login and logout:
```python
urlpatterns = [
    path('login/', auth_views.LoginView.as_view(template_name='users/login.html'), name='login'),
    path('logout/', auth_views.LogoutView.as_view(template_name='users/logout.html'), name='logout'),
]
```

### 3. Create Login Template

Create a file `login.html` in `users/templates/users/`:
```html
{% extends "base_generic.html" %}
{% block content %}
  <h2>Login</h2>
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Login</button>
  </form>
  <p>Need an account? <a href="{% url 'register' %}">Sign up now</a></p>
{% endblock %}
```

### 4. Create Logout Template

Create a file `logout.html` in `users/templates/users/`:
```html
{% extends "base_generic.html" %}
{% block content %}
  <h2>You have been logged out</h2>
  <p><a href="{% url 'login' %}">Login again</a></p>
{% endblock %}
```

### 5. Update Settings for Redirection

In `settings.py`, add the login redirect URL:
```python
LOGIN_REDIRECT_URL = 'blog-home'
```

### 6. Redirect After Registration

In the registration view (`views.py` in `users` app), redirect users to the login page after successful registration:
```python
from django.shortcuts import redirect
from django.contrib import messages

def register(request):
    if request.method == 'POST':
        form = UserRegisterForm(request.POST)
        if form.is_valid():
            form.save()
            username = form.cleaned_data.get('username')
            messages.success(request, f'Your account has been created! You are now able to log in')
            return redirect('login')
    else:
        form = UserRegisterForm()
    return render(request, 'users/register.html', {'form': form})
```

### 7. Verify Authentication System

Test the login and logout functionality:
- Navigate to `/login` and attempt to log in with valid and invalid credentials.
- Ensure users are redirected to the home page after logging in.
- Confirm the logout process by navigating to `/logout` and checking the logout page.

### Troubleshooting

- **Template Not Found Error**: Ensure the template paths are correct and the files exist in the specified directories.
- **Redirect Issues**: Verify the `LOGIN_REDIRECT_URL` in `settings.py` and ensure the paths match the URL names in `urls.py`.

By following these steps and utilizing the provided code snippets, you can set up a robust authentication system in Django, allowing users to log in, log out, and ensure secure access to specific parts of your web application.# Python Django Tutorial: Full-Featured Web App Part 7 - Login and Logout System - YouTube

## Key Insights

- **Authentication System Overview**: Learn how to create a login and logout system for a Django application, ensuring users can log in, log out, and access certain pages only when logged in.
  
- **Importing Auth Views**: 
  ```python
  from django.contrib.auth import views as auth_views
  ```

- **URL Configuration**: Add paths for login and logout views.
  ```python
  from django.urls import path
  from . import views as user_views
  from django.contrib.auth import views as auth_views

  urlpatterns = [
      path('login/', auth_views.LoginView.as_view(template_name='users/login.html'), name='login'),
      path('logout/', auth_views.LogoutView.as_view(template_name='users/logout.html'), name='logout'),
  ]
  ```

- **Creating Login Template**:
  ```html
  
  {% extends "base_generic.html" %}
  {% block content %}
      <h2>Login</h2>
      <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit">Login</button>
      </form>
  {% endblock %}
  ```

- **Customizing Redirects After Login**: Set the redirect URL after a successful login in `settings.py`.
  ```python
  LOGIN_REDIRECT_URL = 'blog-home'
  ```

- **Creating Logout Template**:
  ```html
  
  {% extends "base_generic.html" %}
  {% block content %}
      <h2>You have been logged out</h2>
      <a href="{% url 'login' %}">Login again</a>
  {% endblock %}
  ```

- **Updating Register View to Redirect to Login Page**:
  ```python
  from django.shortcuts import redirect
  from django.contrib import messages

  def register(request):
      if request.method == 'POST':
          form = UserRegisterForm(request.POST)
          if form.is_valid():
              form.save()
              username = form.cleaned_data.get('username')
              messages.success(request, f'Your account has been created! You are now able to log in')
              return redirect('login')
      else:
          form = UserRegisterForm()
      return render(request, 'users/register.html', {'form': form})
  ```

- **Adding Login/Logout Links to Navigation Bar**:
  ```html
  
  <nav>
      <ul>
          {% if user.is_authenticated %}
              <li><a href="{% url 'logout' %}">Logout</a></li>
              <li><a href="{% url 'profile' %}">Profile</a></li>
          {% else %}
              <li><a href="{% url 'login' %}">Login</a></li>
              <li><a href="{% url 'register' %}">Register</a></li>
          {% endif %}
      </ul>
  </nav>
  ```

- **Restricting Access to Views**: Use `login_required` decorator to restrict access to certain views.
  ```python
  from django.contrib.auth.decorators import login_required

  @login_required
  def profile(request):
      return render(request, 'users/profile.html')
  ```

- **Settings for Login URL**: Define `LOGIN_URL` in `settings.py` to redirect to the correct login page.
  ```python
  LOGIN_URL = 'login'
  ```

## Code Snippets

1. **URLs Configuration**:
   ```python
   from django.urls import path
   from django.contrib.auth import views as auth_views
   from . import views as user_views

   urlpatterns = [
       path('login/', auth_views.LoginView.as_view(template_name='users/login.html'), name='login'),
       path('logout/', auth_views.LogoutView.as_view(template_name='users/logout.html'), name='logout'),
   ]
   ```

2. **Login Template**:
   ```html
   {% extends "base_generic.html" %}
   {% block content %}
       <h2>Login</h2>
       <form method="post">
           {% csrf_token %}
           {{ form.as_p }}
           <button type="submit">Login</button>
       </form>
   {% endblock %}
   ```

3. **Logout Template**:
   ```html
   {% extends "base_generic.html" %}
   {% block content %}
       <h2>You have been logged out</h2>
       <a href="{% url 'login' %}">Login again</a>
   {% endblock %}
   ```

4. **Profile View**:
   ```python
   from django.contrib.auth.decorators import login_required

   @login_required
   def profile(request):
       return render(request, 'users/profile.html')
   ```

5. **Navigation Bar Update**:
   ```html
   <nav>
       <ul>
           {% if user.is_authenticated %}
               <li><a href="{% url 'logout' %}">Logout</a></li>
               <li><a href="{% url 'profile' %}">Profile</a></li>
           {% else %}
               <li><a href="{% url 'login' %}">Login</a></li>
               <li><a href="{% url 'register' %}">Register</a></li>
           {% endif %}
       </ul>
   </nav>
   ```

6. **Settings Update**:
   ```python
   LOGIN_REDIRECT_URL = 'blog-home'
   LOGIN_URL = 'login'
   ```